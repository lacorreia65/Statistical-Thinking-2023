#dev.off()
var = (1/20)*(theta_hat^2*(1+theta_hat)^2)/(theta_hat^2+(theta_hat+1)^2)
post_approx = dnorm(theta_vec, theta_hat,sqrt(var))
#pdf(file = "~/Dropbox/pubh8442/2015/Asymptotic_Posterior_Approximation_NormApp##.pdf", width = 7, height=4)
plot(theta_vec,post_approx,xlim = c(0,6),  ylab = "Density", xlab = "theta", type = 'l', lwd = 2, main = "")
abline(v=theta_hat, col = 'red')
#dev.off()
library(rethinking)
data(Howell1)
d <-Howell1[Howell1$age>=18,]
library(rethinking)
library(tidyverse)
library(dplyr)
data(Howell1)
d <-Howell1[Howell1$age>=18,]
Howell |>
plot(H, W)
Howell1 |>
ggplot(aes(x=height, y=weight))+
geom_point()
Howell1 |>
ggplot(aes(x=height, y=weight))+
geom_point(color=sex)+
plot(H, W)
Howell1 |>
ggplot(aes(x=height, y=weight))+
geom_point(color=sex)
Howell1 |>
ggplot(aes(x=height, y=weight))+
geom_point(color=sex)
View(Howell1)
Howell1 |>
ggplot(aes(x=height, y=weight))+
geom_point(color=male)
Howell1 |>
ggplot(aes(x=height, y=weight, color=male))+
geom_point()
Howell1 |>
ggplot(aes(x=weight, y=height, color=male))+
geom_point()
Howell1 |>
ggplot(aes(x=weight, y=height, color=factor(male)))+
geom_point()
Howell1 |>
ggplot(aes(x=hight, y=weight, color=factor(male)))+
geom_point()
Howell1 |>
ggplot(aes(x=height, y=weight, color=factor(male)))+
geom_point()
d |>
ggplot(aes(x=height, y=weight, color=factor(male)))+
geom_point()
plot(H, W)
5/24
d |>
ggplot(aes(x=height, y=weight, color=factor(male)))+
geom_point()
d |>
ggplot(aes(x=height, y=weight, color=factor(male)))+
geom_point()
d |>
ggplot(aes(x=height, y=weight, color=factor(male)))+
geom_density()
d |>
ggplot(aes(x=height, color=factor(male)))+
geom_density(aes(y=weight))
d |>
ggplot(aes(x=weight))+
geom_density(aes(color=factor(male)))
d |>
ggplot(aes(x=height, y=weight, color=factor(male)))+
geom_point()+
theme_bw()
d |>
ggplot(aes(x=weight))+
geom_density(aes(color=factor(male)))+
theme_bw()
d |>
ggplot(aes(x=height, y=weight, color=factor(male)))+
geom_point()+
theme_bw()
d |>
ggplot(aes(x=weight))+
geom_density(aes(color=factor(male)))+
theme_bw()
d |>
ggplot(aes(x=hight))+
geom_density(aes(color=factor(male)))+
theme_bw()
d |>
ggplot(aes(x=height, y=weight, color=factor(male)))+
geom_point()+
theme_bw()
d |>
ggplot(aes(x=weight))+
geom_density(aes(color=factor(male)))+
theme_bw()
d |>
ggplot(aes(x=height))+
geom_density(aes(color=factor(male)))+
theme_bw()
# S = 1: female, S=2: male
sim_HW <- function(S, b, a) {
N <- length(S)
H <- ifelse(S==1,150,160)+rnorm(N,0,5)
data.frame(S,H,W)
}
W <- a[S] + b[S]*H + rnorm(N, 0, 5)
# S = 1: female, S=2: male
sim_HW <- function(S, b, a) {
N <- length(S)
H <- ifelse(S==1,150,160)+rnorm(N,0,5)
W <- a[S] + b[S]*H + rnorm(N, 0, 5)
data.frame(S,H,W)
}
S <- rbern(100)+1
dat <- sim_HW(S, b=c(.5,.6), a=c(0,0))
head(dat)
dat |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
theme_bw()
# female sample
S <- rep(1,100)
simF <- sim_HW(S, b=c(.5,.6), a=c(0,0))
# male sample
S <- rep(2,100)
simM <- sim_HW(S, b=c(.5,.6), a=c(0,0))
# effect of sex (male-female)
mean(simM$W-simF$W)
S <- rbern(100)+1
dat <- sim_HW(S, b=c(.5,.6), a=c(0,0))
# estimate posterior
m_SW <- quap(
alist(
W~dnorm(mu,sigma),
mu <- a[S],
a[S] ~ dnorm(60,10),
sigma ~ dunif(0,10)
), data=dat
)
precis(m_SW,depth=2)
# recoding
dat <- list(
W = d$weight,
S = d$male+1
)
# estimate posterior
m_SW <- quap(
alist(
W~dnorm(mu,sigma),
mu <- a[S],
a[S] ~ dnorm(60,10),
sigma ~ dunif(0,10)
), data=dat
)
precis(m_SW,depth=2)
View(dat)
post <- extract.samples(m_SW)
dens(post$a[,1],xlim=c(35, 55),lwd=3,col=2,xlab="posterior mean weight(kg")
dens(post$a[,2], lwd=3,col=4,add=TRUE)
W1 <- rnorm(1000,post$a[,1], post$sigma)
W2 <- rnorm(1000,post$a[,2], post$sigma)
dens(W1,xlim=c(20,70),ylim(0,.085),lwd=3, col=2)
W1 <- rnorm(1000,post$a[,1], post$sigma)
W2 <- rnorm(1000,post$a[,2], post$sigma)
dens(W1,xlim=c(20,70),ylim=c(0,.085),lwd=3, col=2)
dens(W2,lwd=3, col=4, add=TRUE)
W1
post
mu_contrast <- post$a[,2]-post$a[,1]
dens(mu_contrast,xlim=c(3,10),lwd=3, col=1,xlab="posterior mean weight contrast(kg)")
W1 <- rnorm(1000,post$a[,1], post$sigma)
W2 <- rnorm(1000,post$a[,2], post$sigma)
# conntrast
W_contrast <- W2 - W1
dens(W_contrast,xlim=c(-25,35),lwd=3, col=1,
xlab="posterior weight contrast (kg)")
W1 <- rnorm(1000,post$a[,1], post$sigma)
W2 <- rnorm(1000,post$a[,2], post$sigma)
# conntrast
W_contrast <- W2 - W1
dens(W_contrast,xlim=c(-25,35),lwd=3, col=1,
xlab="posterior weight contrast (kg)")
sum(W_contrast>0)/1000
sum(W_contrast<0)/1000
df <- data.frame (
W1 = W1,
W2 = W2,
W_contrast = W_contrast
)
View(df)
ggplot(df, aes(x=W_contrast, fill=W_contrast))
ggplot(df, aes(x=W_contrast))
ggplot(df, aes(x=W_contrast))+
geom_area()
ggplot(df, aes(x=W_contrast,fill=W_contrast))+
geom_area()
df <- data.frame (
W1 = W1,
W2 = W2,
W_contrast = W_contrast,
W_up = (W_contrast>0),
W_down = !(W_up)
)
df <- data.frame (
W1 = W1,
W2 = W2,
W_contrast = W_contrast,
W_up = (W_contrast>0),
W_down = (W_contrast<0)
)
ggplot(df, aes(x=W_contrast,fill=W_up))+
geom_area()
View(df)
df <- data.frame (
W1 = W1,
W2 = W2,
W_contrast = W_contrast,
W_up = factor(W_contrast>0),
W_down = factor(W_contrast<0)
)
View(df)
ggplot(df, aes(x=W_contrast,fill=W_up))+
geom_area()
ggplot(df, aes(y=W_contrast,fill=W_up))+
geom_area()
ggplot(df, aes(y=W_contrast))+
geom_area()
View(post)
df <- data.frame (
W1 = W1,
W2 = W2,
W_contrast = W_contrast,
W_up = factor(W_contrast>0),
W_down = factor(W_contrast<0)
)
ggplot(df, aes(y=W_contrast))+
geom_density()
ggplot(df, aes(x=W_contrast))+
geom_density()
ggplot(df, aes(x=W_contrast))+
geom_density()+
theme_bw()
ggplot(df, aes(x=W_contrast, fill=W_up))+
geom_density()+
theme_bw()
ggplot(df, aes(x=W_contrast, fill=W_up))+
geom_area()+
theme_bw()
ggplot(df, aes(x=W_contrast), fill=W_up))+
ggplot(df, aes(x=W_contrast), fill=W_up))+
ggplot(df, aes(x=W_contrast), fill=W_up)+
geom_area()+
theme_bw()
ggplot(df, aes(x=W_contrast, y=W_contrastfill=W_up))+
ggplot(df, aes(x=W_contrast, y=W_contrast,fill=W_up))+
geom_area()+
theme_bw()
ggplot(df, aes(x=W_contrast, y=W1,fill=W_up))+
geom_area()+
theme_bw()
df <- data.frame (
W1 = W1,
W2 = W2,
W_contrast = W_contrast,
W_flag = factor(W_contrast>W_up)
)
W_up <- sum(W_contrast>0)/1000
W_down <- sum(W_contrast<0)/1000
df <- data.frame (
W1 = W1,
W2 = W2,
W_contrast = W_contrast,
W_flag = factor(W_contrast>W_up)
)
View(df)
ggplot(df, aes(x=W_contrast,fill=W_flag))+
geom_area()+
theme_bw()
ggplot(df, aes(x=W_contrast,fill=W_flag))+
geom_areadensity()+
theme_bw()
ggplot(df, aes(x=W_contrast,fill=W_flag))+
geom_density()+
theme_bw()
W1 <- rnorm(1000,post$a[,1], post$sigma)
W2 <- rnorm(1000,post$a[,2], post$sigma)
# conntrast
W_contrast <- W2 - W1
dens(W_contrast,xlim=c(-25,35),lwd=3, col=1,
xlab="posterior weight contrast (kg)")
W_up <- sum(W_contrast>0)/1000
W_down <- sum(W_contrast<0)/1000
cat("W_up:",W_up," and W_down:",W_down)
df <- data.frame (
W1 = W1,
W2 = W2,
W_contrast = W_contrast,
W_flag = factor(W_contrast>W_up)
)
ggplot(df, aes(x=W_contrast,fill=W_flag))+
geom_density()+
theme_bw()
S <- rbern(100)+1
dat <- sim_HW(S, b=c(.5,.5), a=c(0,10))
# Indirect effect (b) is the same for men and women
# Indirect effect (b) is the same for men and women
dat |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
theme_bw()
# Indirect effect (b) is the same for men and women
dat |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
theme_bw()
# Indirect effect (b) is the same for men and women
dat |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
facet_wrap(~S)+
theme_bw()
```{r, warning=FALSE}
S <- rbern(100)+1
dat <- sim_HW(S, b=c(.5,.5), a=c(0,10))
# Indirect effect (b) is the same for men and women
dat |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
facet_wrap(~S)+
theme_bw()
S <- rbern(100)+1
dat <- sim_HW(S, b=c(.5,.5), a=c(0,10))
# Indirect effect (b) is the same for men and women
dat |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
facet_wrap(~S)+
theme_bw()
S <- rbern(100)+1
dat <- sim_HW(S, b=c(.5,.5), a=c(0,10))
# Indirect effect (b) is the same for men and women
dat |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
# facet_wrap(~S)+
theme_bw()
dat <- list(
W = d$weight,
H = d$height,
Hbar = mean(d$height),
S = d$male+1 )
m_SHW <- quap(
alist(
W ~ dnorm(mu,sigma),
mu <- a[S]+b[S]*(H-Hbar),
a[S] ~ dnorm(60,10),
b[S] ~ dunif(0,1),
sigma ~ dunif(0,10)
), data=dat
)
dat <- list(
W = d$weight,
H = d$height,
Hbar = mean(d$height),
S = d$male+1 )
m_SHW <- quap(
alist(
W ~ dnorm(mu,sigma),
mu <- a[S]+b[S]*(H-Hbar),
a[S] ~ dnorm(60,10),
b[S] ~ dunif(0,1),
sigma ~ dunif(0,10)
), data=dat
)
precis(m_SHW,depth=2)
post <- extract.samples(m_SHW)
dens(post$a[,1],xlim=c(35, 55),lwd=3,col=2,xlab="posterior mean weight(kg")
dens(post$a[,2], lwd=3,col=4,add=TRUE)
post <- extract.samples(m_SHW)
dens(post$b[,1],xlim=c(35, 55),lwd=3,col=2,xlab="posterior mean weight(kg")
dens(post$b[,2], lwd=3,col=4,add=TRUE)
post <- extract.samples(m_SHW)
dens(post$b[,1],lwd=3,col=2,xlab="posterior mean weight(kg")
dens(post$b[,2],lwd=3,col=4,add=TRUE)
post <- extract.samples(m_SHW)
dens(post$b[,1],xlim=c(.3, .9),lwd=3,col=2,xlab="posterior mean weight(kg")
dens(post$b[,2],lwd=3,col=4,add=TRUE)
post <- extract.samples(m_SHW)
dens(post$b[,1],xlim=c(.3, .9),ylim=c(0,8),
lwd=3,col=2,xlab="posterior mean weight(kg")
dens(post$b[,2],lwd=3,col=4,add=TRUE)
dat <- list(
W = d$weight,
H = d$height,
Hbar = mean(d$height),
S = d$male+1 )
m_SHW <- quap(
alist(
W ~ dnorm(mu,sigma),
mu <- a[S]+b[S]*(H-Hbar),
a[S] ~ dnorm(60,10),
b[S] ~ dunif(0,1),
sigma ~ dunif(0,10)
), data=dat
)
dat |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
# facet_wrap(~S)+
theme_bw()
data.frame(dat) |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
# facet_wrap(~S)+
theme_bw()
```{r, message=FALSE}
dat <- list(
W = d$weight,
H = d$height,
Hbar = mean(d$height),
S = d$male+1 )
m_SHW <- quap(
alist(
W ~ dnorm(mu,sigma),
mu <- a[S]+b[S]*(H-Hbar),
a[S] ~ dnorm(60,10),
b[S] ~ dunif(0,1),
sigma ~ dunif(0,10)
), data=dat
)
dat <- list(
W = d$weight,
H = d$height,
Hbar = mean(d$height),
S = d$male+1 )
m_SHW <- quap(
alist(
W ~ dnorm(mu,sigma),
mu <- a[S]+b[S]*(H-Hbar),
a[S] ~ dnorm(60,10),
b[S] ~ dunif(0,1),
sigma ~ dunif(0,10)
), data=dat
)
dat <- list(
W = d$weight,
H = d$height,
Hbar = mean(d$height),
S = d$male+1 )
m_SHW <- quap(
alist(
W ~ dnorm(mu,sigma),
mu <- a[S]+b[S]*(H-Hbar),
a[S] ~ dnorm(60,10),
b[S] ~ dunif(0,1),
sigma ~ dunif(0,10)
), data=dat
)
data.frame(dat) |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
# facet_wrap(~S)+
theme_bw()
precis(m_SHW,depth=2)
dat <- list(
W = d$weight,
H = d$height,
Hbar = mean(d$height),
S = d$male+1 )
m_SHW <- quap(
alist(
W ~ dnorm(mu,sigma),
mu <- a[S]+b[S]*(H-Hbar),
a[S] ~ dnorm(60,10),
b[S] ~ dunif(0,1),
sigma ~ dunif(0,10)
), data=dat
)
dat <- list(
W = d$weight,
H = d$height,
Hbar = mean(d$height),
S = d$male+1 )
m_SHW <- quap(
alist(
W ~ dnorm(mu,sigma),
mu <- a[S]+b[S]*(H-Hbar),
a[S] ~ dnorm(60,10),
b[S] ~ dunif(0,1),
sigma ~ dunif(0,10)
), data=dat
)
data.frame(dat) |>
ggplot(aes(x=H, y=W, color=factor(S)))+
geom_point()+
geom_smooth(method = lm)+
# facet_wrap(~S)+
theme_bw()
precis(m_SHW,depth=2)
xseq <- seq(from=130,to=190, len=50)
muF <-
link(m_adults2, data=list(S=rep(1,50),H=xseq,Hbar=mean(d$height)))
